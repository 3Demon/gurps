<div class='gurps-app {{classes}}' {{debug}}>
  <div classes='flexcol flex-between'>
    <h2>Apply {{CALC.basicDamage}} points of
      {{printIfNe CALC.armorDivisor 0 '(*)' ' '}}{{CALC.damageType}} damage to
      {{actor.data.name}}</h2>
    <div class='flexrow flex-group-center flex-between'>
      <h3>DIRECTLY APPLY:</h3>
      <input type='number' id='basicDamage' name='damage' value='{{CALC.basicDamage}}'>
      <div>
        <select id='apply-to' name='apply-to'>
          <option value='HP'>Hit Points</option>
          <option value='FP' selected>Fatigue Points</option>
        </select>
      </div>
      <button id='apply-publicly'>Apply</button>
      <button id='apply-secretly'>Apply (Quietly)</button>
    </div>
    <div id='apply-damage-advanced' class='flex-group-left'>
      <h3>APPLY DAMAGE OPTIONS:</h3>

      <div class='grid grid-3col flex-between'>
        <div class='gurps-group'>
          <h4>Hit Location and DR</h4>
          <div class='gurps-3col gurps-radio-col'>
            <header>Location</header>
            <header>Roll</header>
            <header>DR</header>
            {{#each CALC.hitLocationsWithDR}}
            <div><label><input type='radio' name='hitlocation' value='{{this.where}}'>&nbsp;{{this.where}}</label></div>
            <div>{{this.rollText}}</div>
            <div>{{this.dr}}</div>
            {{/each}}
          </div>
          <hr /> <!-- Doesn't do much except add some space -->
          <button id='random-location'>
            <i class='fa fa-dice'><span
                style='font-family: "Font Awesome 5 Free", Signika, sans-serif; font-weight:400'>&nbsp;
                Random
              </span></i>
          </button>
          <hr /> <!-- Doesn't do much except add some space -->
          <div class='gurps-3col gurps-radio-col'>
            <div><label><input type='radio' name='hitlocation' value='Large-Area'>&nbsp;Large-Area Injury</label></div>
            <div></div>
            <div class='pdflink'>B400</div>
          </div>
          <div class='grid grid-2col flex-between'>
            <label><input type='radio' name='hitlocation' value='User Entered'>&nbsp;Enter DR:</input></label>
            <input type='number' id='user-entered-dr' name='User Entered' value='{{CALC.userEnteredDR}}'>
          </div>
        </div>

        <div class='gurps-group'>
          <h4>Type and Wounding Modifiers</h4>
          <section id='wound-modifier-table'>
          </section>
          <hr /> <!-- Doesn't do much except add some space -->
          <label><input type='radio' name='woundmodifier' value='none'>&nbsp;No modifier</input></label>
          <div class='grid grid-2col flex-between'>
            <label><input type='radio' name='woundmodifier' value='User Entered'>&nbsp;Enter
              modifier:</input></label>
            <input type='number' id='user-entered-woundmod' name='User Entered' value='1'>
          </div>
          <div class='grid grid-2col flex-between'>
            <label>Additional modifier (stacks):</label>
            <input type='number' id='addmodifier' name='addmodifier' value='{{CALC._additionalWoundModifier}}'>
          </div>
        </div>

        <div class='gurps-group'>
          <h4>Tactical Rules</h4>
          <aside>Use systems settings to set defaults.</aside>
          <div class='gurps-3col gurps-checkbox-col'>
            {{#each tacticalOptions}}
            <div><input id='tactical-{{this.id}}' type='checkbox' name='tactical' value='{{this.id}}'></input></div>
            <div><label for='tactical-{{this.id}}'>{{this.label}}</label></div>
            <div class='pdflink'>{{this.ref}}</div>
            {{/each}}
          </div>

          <h4>Other Situations</h4>
          <div class='gurps-3col gurps-checkbox-col'>
            {{#each otherSituations}}
            <div><input id='specials-{{this.id}}' type='checkbox' name='specials' value='{{this.id}}'></input>
            </div>
            <div><label for='specials-{{this.id}}'>{{this.label}}</label></div>
            <div class='pdflink'>{{this.ref}}</div>
            {{/each}}
          </div>
          <div class='shaded collapsible-wrapper options-drawer'>
            <input id='vulnerable' class='toggle' type='checkbox' name='vulnerable' value='vulnerable'></input>
            <label for='vulnerable' class='label-toggle'>Vulnerability:<span class='pdflink'>B161</span></label>
            <div class='grid grid-3col continuation collapsible-content'>
              <label><input disabled checked type='radio' name='vulnerability' value='vulnerability-2'>&nbsp;×2</label>
              <label><input disabled type='radio' name='vulnerability' value='vulnerability-3'>&nbsp;×3</label>
              <label><input disabled type='radio' name='vulnerability' value='vulnerability-4'>&nbsp;×4</label>
            </div>
          </div>
          <div class='collapsible-wrapper options-drawer'>
            <input id='hardened' class='toggle' type='checkbox' name='hardened' value='hardened'></input>
            <label for='hardened' class='label-toggle'>Hardened DR Level: <span class='pdflink'>B47</span></label>
            <div class='grid grid-5col continuation collapsible-content'>
              <label><input type='radio' name='hardened' value='hardened-1'>&nbsp;1</label>
              <label><input type='radio' name='hardened' value='hardened-2'>&nbsp;2</label>
              <label><input type='radio' name='hardened' value='hardened-3'>&nbsp;3</label>
              <label><input type='radio' name='hardened' value='hardened-4'>&nbsp;4</label>
              <label><input type='radio' name='hardened' value='hardened-5'>&nbsp;5</label>
            </div>
          </div>
          <div class='shaded collapsible-wrapper options-drawer'>
            <input id='injury-tolerance' class='toggle' type='checkbox' name='injury-tolerance'
              value='injury-tolerance'></input>
            <label for='injury-tolerance' class='label-toggle'>Injury Tolerance:<span class='pdflink'>
                B60</span></label>
            <div class='collapsible-content continuation'>
              <div><label><input type='radio' name='injury-tolerance' value='unliving'>&nbsp;Unliving<span
                    class='pdflink'>B380</span></label></div>
              <div><label><input type='radio' name='injury-tolerance' value='homogenous'>&nbsp;Homogenous<span
                    class='pdflink'>B380</span></label>
              </div>
              <div><label><input disabled type='radio' name='injury-tolerance' value='diffuse'>&nbsp;Diffuse<span
                    class='pdflink'>B380</span></label>
              </div>
            </div>
          </div>
          <div id='specials-insert-point' class='gurps-3col' />
        </div>
      </div>
    </div>

    <div>
      <div class='gurps-group'>
        <h4>Calculation and Results</h4>
        <div class='grid grid-3col'>
          <div class='gurps-3col results-table'>
            <div>BASIC&nbsp;DAMAGE</div>
            <div><span name='result-basic'>{{CALC.basicDamage}}</span></div>
            <div><span name='result-apply-to'>{{CALC.applyTo}}</span></div>

            <div id='result-dr'>DR</div>
            <div><span name='result-dr'>{{CALC.DR}}</span></div>
            <div><span name='result-hitlocation'>{{CALC.hitLocation}}</span></div>

            <div id='result-penetrating'>PENETRATING</div>
            <div><span name='result-penetrating'>{{CALC.penetratingDamage}}</span></div>
            <div><span>= <span name='result-halfdamage'>{{CALC.basicDamage}}</span> &minus; <span
                  name='result-effective-dr'>{{CALC.effectiveDR}}</span></span></div>

            <div>MODIFIER</div>
            <div><span>×<span name='result-totalmod'>{{fractionalize CALC.totalWoundingModifier 2}}</span></span></div>
            <div><span>= <span name='result-addmods'>({{CALC.damageType}})</span><span id='modifier-footnote-wrapper'>*
                  <span id="modifier-footnote" class="pdflink">B398</span></span></span>
            </div>

            <div>INJURY</div>
            <div><span name='result-injury'>{{CALC.injury}}</span></div>
            <div id='result-injury-total'><span>= <span
                  name='result-penetrating'>{{calculating.penetratingDamage}}</span>
                × <span name='result-totalmod'>{{fractionalize CALC.totalWoundingModifier 2}}</span></span></div>
          </div>

          <div id="result-extrastuff">
            <ul id='result-effects'>
            </ul>
          </div>

          <div class='apply-results'>
            <input style='font-size: larger; font-weight: bolder; border: 1px black solid;' disabled type='number'
              id='result-apply-injury' name='damage' value='{{CALC.pointsToApply}}'>
            <button id='apply-injury-publicly'>Apply Injury</button>
            <button id='apply-injury-secretly'>Apply Injury (Quietly)</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>